# DashPlayer 设置页面重构前功能记录

## 当前设置页面结构

### 页面布局
- 位置：`src/fronted/pages/setting/SettingLayout.tsx`
- 左侧导航栏包含7个设置分类：
  1. 快捷键 (`shortcut`)
  2. 外观 (`appearance`) 
  3. 字幕翻译 (`tenant`)
  4. 查单词 (`you-dao`)
  5. OpenAI (`open-ai`)
  6. 存储 (`storage`)
  7. 版本更新 (`update`)

### 当前各页面功能

#### 1. OpenAI 设置页面 (`OpenAiSetting.tsx`)
**配置项：**
- API Key (`apiKeys.openAi.key`) - 密码类型输入
- Endpoint (`apiKeys.openAi.endpoint`) - 默认：https://api.openai.com
- Model (`model.gpt.default`) - 下拉选择：gpt-4o-mini(推荐)、gpt-4o、gpt-3.5-turbo
- Stream 响应选项（已注释掉）

**应用范围：**
- 转录功能
- AI 生成功能
- OpenAI翻译（当翻译引擎选择OpenAI时）

#### 2. 有道设置页面 (`YouDaoSetting.tsx`)
**配置项：**
- SecretId (`apiKeys.youdao.secretId`)
- SecretKey (`apiKeys.youdao.secretKey`) - 密码类型

**应用范围：**
- 查单词功能

#### 3. 腾讯云设置页面 (`TenantSetting.tsx`)
**配置项：**
- 翻译引擎选择 (`translation.engine`) - 选项：腾讯翻译、OpenAI翻译
- 腾讯云 SecretId (`apiKeys.tencent.secretId`) - 当选择腾讯翻译时显示
- 腾讯云 SecretKey (`apiKeys.tencent.secretKey`) - 密码类型，当选择腾讯翻译时显示

**应用范围：**
- 字幕翻译功能
- 翻译引擎切换逻辑

### 当前技术实现

#### 前端状态管理
- 使用自定义Hook：`useSettingForm` 
- 基于Zustand的 `useSetting` store
- 本地状态与服务器状态对比逻辑
- 手动提交机制（Apply按钮）

#### 后端存储
- 服务：`SettingService` / `SettingServiceImpl`
- 控制器：`StorageController` (处理storage/ API路径)
- 存储方式：通过 `store.ts` 的 `storeGet/storeSet` 方法
- IPC通信：使用 'store-update' 事件同步状态

#### API路径
- `storage/put` - 设置存储
- `storage/get` - 获取设置
- `storage/cache/size` - 缓存大小查询
- `storage/collection/paths` - 集合路径列表

### 设置项数据结构
所有设置项定义在 `store_schema.ts` 中：

```typescript
export const SettingKeyObj = {
    // 快捷键设置...
    'apiKeys.youdao.secretId': '',
    'apiKeys.youdao.secretKey': '',
    'apiKeys.tencent.secretId': '',
    'apiKeys.tencent.secretKey': '',
    'apiKeys.openAi.key': '',
    'apiKeys.openAi.endpoint': '',
    'apiKeys.openAi.stream': 'on',
    'translation.engine': 'tencent',
    'model.gpt.default': 'gpt-4o-mini',
    // 其他设置...
}
```

### 当前交互方式
- 使用自定义 `SettingInput` 组件
- 自定义 `useSettingForm` Hook处理表单状态
- 手动比较本地状态与服务器状态
- 批量提交更改

### 需要保留的功能特性
1. **多服务配置**：OpenAI、腾讯云、有道云
2. **翻译引擎切换**：腾讯翻译 vs OpenAI翻译，有相应的配置显示/隐藏逻辑
3. **应用范围控制**：
   - OpenAI：转录、AI生成、OpenAI翻译
   - 腾讯云：字幕翻译（腾讯引擎）
   - 有道云：查单词
4. **复选框功能需求**：
   - 整句学习开关
   - 字幕翻译开关
5. **数据验证**：API Key格式验证
6. **文档链接**：各服务的配置文档链接

### 重构目标
将三个独立页面（OpenAI、腾讯云、有道云）合并为统一的服务管理页面，使用React Hook Form替代自定义Hook，新增SettingsController处理后端逻辑。

## 新的交互逻辑设计

### 统一服务管理页面结构
```
AI 服务配置
├── OpenAI
│   ├── API Key
│   ├── API 端点
│   ├── 模型选择
│   └── 启用功能
│       ├── ☑️ 整句学习
│       └── ☑️ 字幕翻译 (与腾讯云互斥)
├── 腾讯云翻译
│   ├── SecretId
│   ├── SecretKey  
│   └── 启用功能
│       └── ☑️ 字幕翻译 (与OpenAI互斥)
└── 有道词典
    ├── App Key
    ├── App Secret
    └── 启用功能
        └── ☑️ 词典查询
```

### 互斥逻辑规则
1. **字幕翻译功能**：OpenAI 和腾讯云翻译的字幕翻译复选框互斥
2. **整句学习功能**：目前只有 OpenAI 支持
3. **词典查询功能**：目前只有有道词典支持

### 需要新增的设置项
需要在 `store_schema.ts` 中新增以下设置项：
- `services.openai.enableSentenceLearning`: boolean - 整句学习功能
- `services.openai.enableSubtitleTranslation`: boolean - OpenAI字幕翻译
- `services.tencent.enableSubtitleTranslation`: boolean - 腾讯云字幕翻译  
- `services.youdao.enableDictionary`: boolean - 词典查询功能

### 数据结构变更
原来的 `translation.engine` 将被新的互斥复选框逻辑替代。